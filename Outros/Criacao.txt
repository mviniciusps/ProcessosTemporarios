CREATE DATABASE ProcessosTemporarios;

USE ProcessosTemporarios;

CREATE TABLE TB_CE_MERCANTE
(
	CE_ID INT IDENTITY(1,1), --PK, MUDAR PARA SEQUENCE
	Status_CE VARCHAR(15) NOT NULL,
	Numero_CE CHAR(15), --UNIQUE
	CONSTRAINT PK_CE_ID PRIMARY KEY(CE_ID),
	CONSTRAINT UQ_NUMERO_CE UNIQUE(Numero_CE)
)

CREATE TABLE TB_RECINTO_ALFANDEGADO
(
	RecintoID INT IDENTITY(1,1), --PK, mudar para SEQUENCE
	NumeroRecintoAduaneiro CHAR(7) NOT NULL, --UNIQUE
	NomeRecinto VARCHAR(50) NOT NULL,
	CidadeRecinto VARCHAR(20) NOT NULL,
	EstadoRecinto VARCHAR(20) NOT NULL,
	UnidadeReceitaFederal CHAR(7) NOT NULL,
	CONSTRAINT PK_RECINTO_ID PRIMARY KEY(RecintoID),
	CONSTRAINT UQ_NUMERO_RECINTO UNIQUE(NumeroRecintoAduaneiro)
)

CREATE TABLE TB_APOLICE_SEGURO_GARANTIA
--Salvar varias apolices para o mesmo processo
(
	ApoliceID INT IDENTITY(1,1), --PK, MUDAR PARA SEQUENCE
	NumeroApolice VARCHAR(100),
	VencimentoGarantia DATE NOT NULL,
	RecintoID INT NOT NULL, --FK
	CONSTRAINT PK_APOLICE_ID PRIMARY KEY(ApoliceID),
	CONSTRAINT FK_RECINTO_ID FOREIGN KEY(RecintoID) REFERENCES TB_RECINTO_ALFANDEGADO(RecintoID)
)

CREATE TABLE TB_CONTRATO
(
	ContratoID INT IDENTITY(1,1), --PK, MUDAR PARA SEQUENCE
	NumeroNomeContrato VARCHAR(100) NOT NULL,
	ContratoTipo VARCHAR(20) NOT NULL,
	ContratoDataAssinatura DATE NOT NULL,
	ContratoVencimento DATE NOT NULL, --UPDATE PARA MUDAR COM DIAS APENAS
	MostrarDiasSomados,
	Prorroga√ßaoNumero,
	CONSTRAINT PK_CONTRATO_ID PRIMARY KEY(ContratoID)
)

CREATE TABLE TB_CNPJ
(
	CNPJ_ID INT IDENTITY(1,1), --PK
	NumeroInscricao CHAR(14) NOT NULL, --UNIQUE
	NomeEmpresarial VARCHAR(100) NOT NULL,
	Logradouro VARCHAR(100) NOT NULL,
	NumeroLogradouro VARCHAR(10) NULL,
	BairroLogradouro VARCHAR(50) NULL,
	CidadeLogradouro VARCHAR(50) NOT NULL,
	EstadoLogradouro VARCHAR(50) NOT NULL,
	CONSTRAINT PK_CNPJ_ID PRIMARY KEY(CNPJ_ID),
	CONSTRAINT UQ_CNPJ_INSCRICAO UNIQUE(NumeroInscricao)
)


CREATE TABLE TB_DECLARACAO
(
	DeclaracaoID INT IDENTITY(1,1),
	NumeroDeclaracao VARCHAR(12) NOT NULL, -- CHECK/IF/UNIQUE
	CNPJ_ID INT NOT NULL, --FK
	ReferenciaBraslog CHAR(13) NOT NULL, --UNIQUE
	ReferenciaCliente VARCHAR(20) NOT NULL,
	DataRegistroDeclaracao DATE NOT NULL,
	DataDesembaracoDeclaracao DATE NOT NULL,
	CE_ID INT, --FK
	RecintoID INT NOT NULL, --FK
	NumeroDOSSIE CHAR(15), --UNIQUE
	NumeroProcessoAdministrativo CHAR(15),
	ContratoID INT, --FK
	ApoliceID INT, --FK
	Modal VARCHAR(15) NOT NULL,
	CONSTRAINT PK_DECLARACAO_ID PRIMARY KEY(DeclaracaoID),
	CONSTRAINT CHK_NUMERODECLARACAO_LENGTH CHECK(LEN(NumeroDeclaracao) BETWEEN 10 AND 12),
	CONSTRAINT FK_DECLARACAO_CNPJ_ID FOREIGN KEY(CNPJ_ID) REFERENCES TB_CNPJ(CNPJ_ID),
	CONSTRAINT FK_DECLARACAO_CE_ID FOREIGN KEY(CE_ID) REFERENCES TB_CE_MERCANTE(CE_ID),
	CONSTRAINT FK_DECLARACAO_RECINTO_ID FOREIGN KEY(RecintoID) REFERENCES TB_RECINTO_ALFANDEGADO(RecintoID),
	CONSTRAINT FK_CONTRATO_ID FOREIGN KEY(ContratoID) REFERENCES TB_CONTRATO(ContratoID),
	CONSTRAINT FK_APOLICE_ID FOREIGN KEY(ApoliceID) REFERENCES TB_APOLICE_SEGURO_GARANTIA(ApoliceID)
)

